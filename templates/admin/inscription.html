{% extends 'base/layout.html' %}

{% block title %}eScholar{% endblock %}

{% block sidebar%}
{% include 'partials/learner_sidebar.html' %}
{% endblock %}

{% block Dashboard %} Inscriptions{% endblock %}

{% block ContentTitle %}
Admin
{% endblock %}

{% block ContentSubTitle %}
Tableau de Bord
{% endblock %}

{% block content %}
{% for msg in messages %}
{% if msg %}
<script>
    Swal.fire({
        position: 'center',
        icon: 'success',
        title: msg,
        showConfirmButton: false,
        timer: 2800
    }).then(function() {
    });
</script>
{% endif %}
{% endfor %}


<section class="section">
    <div class="row">
        <div class="col-lg-12">

            <div class="card">
                <div class="filter">
                    <a class="icon " data-bs-toggle="modal" data-bs-target="#exampleModal"><i
                            class="bi bi-plus-circle-fill h4"></i></a>
                </div>
                <div class="card-body">
                    <h5 class="card-title">Inscriptions</h5>
                    <!-- Table with stripped rows -->
                    <table class="table datatable">
                        <thead>
                            <tr>
                                <th scope="col">#</th>
                                <th scope="col">Date_inscription</th>
                                <th scope="col">Apprenant</th>
                                <th scope="col">Formation</th>
                                <th scope="col">Modalite</th>
                                <th scope="col">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for inscription in Inscriptions %}
                            <tr>
                                <th scope="row">{{ inscription.code }}</th>
                                <td>{{ inscription.date_inscription }}</td>
                                <td>{{ insciption.apprenant_id.nom }} {{inscription.apprenant_id.postnom}}
                                    {{inscription.apprenant_id.prenom}}</td>
                                <td>{{ inscription.formation_id.titre }}</td>
                                <td>{{ inscription.modalite_id.tranche }}</td>
                                    <a class="text-info mx-auto md-2" data-bs-toggle="modal"
                                        data-bs-target="#exampleModal1-{{forloop.counter}}">
                                        <span class="badge bg-success ">
                                            <i class="bi bi-pencil-square fa-lg " data-toggle="tooltip"
                                                data-placement="top" title="Modifier cet élément"></i>
                                        </span>
                                    </a>
                                    <a class="text-info mx-auto pd-2" href="{{ inscription.code }}">
                                        <span class="badge bg-danger ">
                                            <i class="bi bi-trash fa-lg "></i>
                                        </span>
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    <!-- End Table with stripped rows -->

                </div>
            </div>

        </div>
    </div>
</section>

<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered ">
        <div class="modal-content">
            <div class="modal-header border-bottom-0 ">
                <h5 class="modal-title fw-bold" id="exampleModalLabel">Nouvelle inscription </h5>
                <button type="button" class="btn-close h2 fw-bold" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body ">
                <form method="POST" action="{% url 'insertInscription' %}">
                    {% csrf_token %}
                    <div class="col-md-12 mb-4 ">
                        <div class="input-group has-validation">
                            <input type="text" name="date_inscription" class="form-control mb-3" id="date_inscription" placeholder="Date_inscription"
                                required>
                        </div>
                        <div class="input-group has-validation">
                            <select class="form-select mb-3" name="apprenant_id" id="">
                                <option value="">--select Apprenant--</option>

                                {% for a in apprenants %}
                                <option value="{{ a.matricule }}">{{ a.nom }} {{a.postnom}} {{a.prenom}}</option>
                                {% endfor %}

                            </select>
                        </div>
                        <div class="input-group has-validation">
                            <select name="formation_id" id="">
                                <option value="">--select formation--</option>

                                {% for f in formations %}
                                <option value="{{ f.code }}">{{ f.titre }} </option>
                                {% endfor %}

                            </select>
                        </div>
                        <div class="input-group has-validation">
                            <select name="modalite_id" id="">
                                <option value="">--select modalitepaie--</option>

                                {% for m in modalitepaie %}
                                <option value="{{ m.code }}">{{ m.tranche }} </option>
                                {% endfor %}

                            </select>
                        </div>
                    </div>

                    <div class="col-md-12 text-center">
                        <button name="save" class="btn btn-secondary w-50 fw-bold " type="submit">Enregistrer</button>
                    </div>
                </form>
            </div>
            <div class="modal-footer border-top-0">

            </div>
        </div>
    </div>
</div>

<!-- Modal Modification inscription-->
{% for inscription in inscriptions %}
<div class="modal fade" id="exampleModal1-{{forloop.counter}}" tabindex="-1" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered ">
        <div class="modal-content">
            <div class="modal-header border-bottom-0 ">
                <h5 class="modal-title fw-bold" id="exampleModalLabel">Modification Inscription</h5>
                <button type="button" class="btn-close h2 fw-bold" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body ">
                <form method="POST" action="{% url 'updateInscription' %}">
                    {% csrf_token %}
                    <input type='hidden' value="{{inscription.code}}" name='code'>
                    <div class="col-md-12 mb-4 ">
                        <div class="col-md-12 mb-4 ">
                            <div class="input-group has-validation">
                                <input type="text" name="date_inscription" class="form-control" id="date_inscription" value="{{ inscription.date_inscription }}"placeholder="Date_inscription"
                                    required>
                            </div>
                            <div class="input-group has-validation">
                                <select value="{{ insciption.apprenant_id.nom }} {{inscription.apprenant_id.postnom}}
                                    {{inscription.apprenant_id.prenom}" name="apprenant_id" id="">
                                    <option value="">--select Apprenant--</option>
    
                                    {% for a in apprenants %}
                                    <option value="{{ a.matricule }}">{{ a.nom }} {{a.postnom}} {{a.prenom}}</option>
                                    {% endfor %}
    
                                </select>
                            </div>
                            <div class="input-group has-validation">
                                <select value="{{ inscription.formation_id.titre }}" name="formation_id" id="">
                                    <option value="">--select formation--</option>
    
                                    {% for f in formations %}
                                    <option value="{{ f.code }}">{{ f.titre }} </option>
                                    {% endfor %}
    
                                </select>
                            </div>
                            <div class="input-group has-validation">
                                <select value="{{ inscription.modalite_id.tranche }}" name="modalite_id" id="">
                                    <option value="">--select modalitepaie--</option>
    
                                    {% for m in modalitepaie %}
                                    <option value="{{ m.code }}">{{ m.tranche }} </option>
                                    {% endfor %}
    
                                </select>
                            </div>
                        </div>
                        <div class="input-group has-validation">
                            <select value="{{ formation.module_id.titre }}" name="module" id="">
                                <option value="">--select Module--</option>

                                {% for m in modules %}
                                <option value="{{ m.code }}">{{ m.titre }} </option>
                                {% endfor %}

                            </select>
                        </div>    
                        </div>
                    </div>

                    <div class="col-md-12 text-center">
                        <button name="save" class="btn btn-success w-50 fw-bold " type="submit">Modifier</button>
                    </div>
                </form>
            </div>
            <div class="modal-footer border-top-0">

            </div>
        </div>
    </div>
</div>
{% endfor %}

{% endblock %}