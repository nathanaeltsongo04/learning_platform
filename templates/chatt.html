{% extends 'base/layout.html' %}

{% block title %}
  eScholar
{% endblock %}

{% block sidebar %}
  {% include 'partials/learner_sidebar.html' %}
{% endblock %}
{% block Dashboard %}
  Chat
{% endblock %}

{% block ContentTitle %}
  Apprenant
{% endblock %}

{% block ContentSubTitle %}
  Tableau de Bord
{% endblock %}

{% block content %}
<style>
    body {
        background-color: none;
    }
    .chat-container {
        height: 90vh;
        display: flex;
    }
    .chat-list {
        background-color: none;
        border-right: 0px solid #ddd;
        overflow-y: auto;
    }
    .chat-list .list-group-item {
        cursor: pointer;
    }
    .chat-list .list-group-item:hover {
        background-color: none;
    }
    .chat-messages {
        background-color: none ;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }
    .chat-header {
        background-color: none;
        padding: 15px;
        border-bottom: 0px solid #ddd;
    }
    .message {
        padding: 10px;
        margin-bottom: 10px;
        border-radius: 10px;
        max-width: 70%;
    }
    .message.sent {
        background-color: white;
        align-self: flex-end;
    }
    .message.received {
        background-color: white;
        align-self: flex-start;
    }
    .chat-footer {
        background-color: none;
        padding: 15px;
        border-top: 0px solid #ddd;
    }
    .chat-footer textarea {
        width: 80%;
        resize: none;
        border: none;
        border-radius: 20px;
        padding: 10px;
    }
    #floating-new-chat-btn {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        font-size: 24px;
        text-align: center;
        line-height: 24px;
        box-shadow: 0px 2px 5px rgba(0,0,0,0.3);
        z-index: 1000;
    }
    
</style>
<div class="container-fluid chat-container">
    <div class="col-4 chat-list p-0 mt-2 ">
        <ul class="list-group list-group-flush">
            <li class="list-group-item bg-light border-bottom-0" data-username="John Doe">
                <div class="d-flex align-items-center ">
                    <img src="https://via.placeholder.com/50" class="rounded-circle me-3" alt="User Image">
                    <div>
                        <h6 class="mb-0">John Doe</h6>
                        <p class="text-muted mb-0">Last message preview...</p>
                    </div>
                </div>
            </li>
            <li class="list-group-item bg-light border-bottom-0" data-username="Jane Smith">
                <div class="d-flex align-items-center">
                    <img src="https://via.placeholder.com/50" class="rounded-circle me-3" alt="User Image">
                    <div>
                        <h6 class="mb-0">Jane Smith</h6>
                        <p class="text-muted mb-0">Last message preview...</p>
                    </div>
                </div>
            </li>
            <li class="list-group-item bg-light border-bottom-0" data-username="Mike Ross">
                <div class="d-flex align-items-center">
                    <img src="https://via.placeholder.com/50" class="rounded-circle me-3" alt="User Image">
                    <div>
                        <h6 class="mb-0">Mike Ross</h6>
                        <p class="text-muted mb-0">Last message preview...</p>
                    </div>
                </div>
            </li>
        </ul>
    </div>

    <div class="col-8 chat-messages p-0">
        <div class="chat-header">
            <h4 class="fw-bold text-primary">Chat with <span id="chat-username">John Doe</span></h4>
        </div>
        <div class="chat-body flex-grow-1 p-3 d-flex flex-column" style="overflow-y: auto;">
            <!-- Les messages seront chargés ici dynamiquement -->
        </div>
        <div class="chat-footer">
            <form class="d-flex">
                <textarea rows="1" placeholder="Type a message..."></textarea>
                <button class="btn btn-primary ms-2" type="submit">Send</button>
            </form>
        </div>
    </div>
</div>
<!-- Bouton flottant pour démarrer une nouvelle conversation -->
<button id="floating-new-chat-btn" class="btn btn-primary"><i class="bi bi-chat-text"></i></button>


<script>
// Exemple de structure de données pour les messages
const conversations = {
    "John Doe": [
        { type: "received", text: "Hey, how are you?", time: "10:00 AM" },
        { type: "sent", text: "I'm good, thanks! How about you?", time: "10:05 AM" },
        { type: "received", text: "Doing great! Let's catch up later.", time: "10:10 AM" }
    ],
    "Jane Smith": [
        { type: "received", text: "Are you coming to the meeting?", time: "11:00 AM" },
        { type: "sent", text: "Yes, I'll be there.", time: "11:05 AM" }
    ],
    "Mike Ross": [
        { type: "received", text: "Can you review the document?", time: "12:00 PM" },
        { type: "sent", text: "Sure, I'll look into it.", time: "12:15 PM" }
    ]
};

document.querySelectorAll('.chat-list .list-group-item').forEach(item => {
    item.addEventListener('click', function() {
        const username = this.getAttribute('data-username');
        loadConversation(username);
    });
});

function loadConversation(username) {
    const chatHeader = document.querySelector('.chat-header h4 #chat-username');
    const chatBody = document.querySelector('.chat-body');

    // Met à jour l'en-tête avec le nom d'utilisateur
    chatHeader.textContent = username;

    // Efface les messages actuels
    chatBody.innerHTML = '';

    // Charge les messages pour l'utilisateur sélectionné
    const messages = conversations[username];
    messages.forEach(message => {
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${message.type}`;
        messageDiv.innerHTML = `
            <p>${message.text}</p>
            <small class="text-muted">${message.time}</small>
        `;
        chatBody.appendChild(messageDiv);
    });
}

</script>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}
